generator client {
  provider = "prisma-client"
  output   = "generated/prisma-client"
}

datasource db {
  provider = "postgresql"
}

model Consultation {
  id         Int                 @id @default(autoincrement())
  userId     Int
  doctorId   Int
  date       DateTime
  notes      String
  createdAt  DateTime            @default(now())
  updatedAt  DateTime            @updatedAt
  deletedAt  DateTime? 

  endTime    DateTime           
  status     ConsultationStatus  @default(scheduled)  
  type       ConsultationType   
  location   String

  doctor     Doctor              @relation(fields: [doctorId], references: [id])
  user       User                @relation(fields: [userId], references: [id])
  referrals  Referral[]

  @@index([userId])
  @@index([doctorId])
  @@index([date])
}

enum ConsultationStatus {
  scheduled
  completed
  cancelled
  no_show
}

enum ConsultationType {
  return_visit
  exam
  routine
  checkup
}

model Doctor {
  id            Int            @id @default(autoincrement())
  firstName     String
  lastName      String
  speciality    String
  phoneNumber   String         @unique
  birthDate     DateTime
  email         String         @unique
  password      String
  crm           String         @unique
  cpf           String         @unique
  role          Role           @default(doctor)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  consultations Consultation[]

  referralsMade     Referral[] @relation("ReferralReferredBy")
  referralsReceived Referral[] @relation("ReferralReferredTo")
}

model Referral {
  id             Int          @id @default(autoincrement())
  consultationId Int
  userId         Int
  referredById   Int
  referredToId   Int
  reason         String
  notes          String      
  status         String       @default("pending")
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  deletedAt      DateTime?    
  consultation   Consultation @relation(fields: [consultationId], references: [id])
  user           User         @relation(fields: [userId], references: [id])
  referredBy     Doctor       @relation("ReferralReferredBy", fields: [referredById], references: [id])
  referredTo     Doctor       @relation("ReferralReferredTo", fields: [referredToId], references: [id])
}



model User {
  id            Int            @id @default(autoincrement())
  firstName     String 
  lastName      String
  phoneNumber   String         @unique
  email         String         @unique
  cpf           String         @unique
  password      String
  birthDate     DateTime
  createdAt     DateTime       @default(now())
  updatedAt     DateTime?
  deletedAt     DateTime?
  role          String         @default("user")
  consultations Consultation[]

  referrals Referral[]
}

enum Role {
  doctor
  admin
}
